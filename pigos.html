<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PigOS - Matopeli</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { overflow: hidden; height: 100vh; color: white; }
        
        /* BIOS-n√§ytt√∂ */
        #bios-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #001a00;
            color: #33ff33;
            font-family: 'Courier New', monospace;
            padding: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .bios-content {
            max-width: 700px;
            width: 100%;
        }
        
        .bios-line {
            margin-bottom: 10px;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .bios-logo {
            font-size: 48px;
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 0 10px #33ff33;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { text-shadow: 0 0 10px #33ff33; }
            50% { text-shadow: 0 0 20px #33ff33, 0 0 30px #33ff33; }
            100% { text-shadow: 0 0 10px #33ff33; }
        }
        
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #002200;
            border: 1px solid #33ff33;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #33ff33;
            transition: width 0.5s ease;
        }
        
        /* Oletusteema (sininen) */
        body[data-theme="blue"] {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        /* Tumma teema */
        body[data-theme="dark"] {
            background: linear-gradient(135deg, #121212 0%, #333333 100%);
        }
        
        /* Vaalea teema */
        body[data-theme="light"] {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }
        
        /* Vaalean teeman mukautukset */
        body[data-theme="light"] .desktop-icon {
            color: #333;
        }
        
        body[data-theme="light"] .taskbar {
            background: rgba(200, 200, 200, 0.9);
            color: #333;
        }
        
        .desktop { width: 100vw; height: 100vh; position: relative; }
        .desktop-icons { position: absolute; top: 20px; left: 20px; }
        .desktop-icon { width: 80px; height: 80px; margin: 10px; text-align: center; cursor: pointer; color: white; }
        .icon-image { font-size: 40px; margin-bottom: 5px; }
        .icon-label { font-size: 12px; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        
        .taskbar { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            height: 40px; 
            background: rgba(30,30,30,0.9); 
            display: flex; 
            align-items: center; 
            padding: 0 20px; 
            z-index: 999; 
            justify-content: space-between;
        }
        .taskbar-left { display: flex; align-items: center; gap: 10px; }
        .taskbar-right { display: flex; align-items: center; gap: 10px; }
        
        .start-button, .taskbar-button { 
            padding: 0 15px; 
            height: 30px; 
            background: #0078d7; 
            border: none; 
            border-radius: 5px; 
            color: white; 
            cursor: pointer; 
        }

        .window { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 600px; 
            height: 400px; 
            background: white; 
            border-radius: 10px; 
            display: none; 
            flex-direction: column; 
            z-index: 100; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .window-header { padding: 15px; background: #0078d7; color: white; border-radius: 10px 10px 0 0; 
                         display: flex; justify-content: space-between; align-items: center; cursor: grab; user-select: none; }
        .window-header:active { cursor: grabbing; }
        .window-content { flex: 1; padding: 20px; color: #333; overflow: auto; }
        
        .update-notification { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #4CAF50; 
            color: white; 
            padding: 15px; 
            border-radius: 8px; 
            z-index: 10000; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
        }
        
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3;
                    border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Logo animaatio */
        .logo-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s;
        }
        
        .logo-animation.visible {
            opacity: 1;
        }
        
        .logo {
            font-size: 80px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
            animation: logoPulse 2s infinite;
        }
        
        @keyframes logoPulse {
            0% { transform: scale(1); text-shadow: 0 0 20px rgba(255, 255, 255, 0.7); }
            50% { transform: scale(1.1); text-shadow: 0 0 30px rgba(255, 255, 255, 1); }
            100% { transform: scale(1); text-shadow: 0 0 20px rgba(255, 255, 255, 0.7); }
        }

        .log-entry {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        /* Sammutus- ja uudelleenk√§ynnistysn√§kym√§ */
        #shutdown-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 2em;
            z-index: 10001;
            display: none;
        }

        /* K√§ynnist√§-valikko */
        #start-menu {
            position: fixed;
            bottom: 45px;
            left: 20px;
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 998;
            display: none;
            flex-direction: column;
        }

        .start-menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 6px;
            cursor: pointer;
            color: #333;
            transition: background 0.2s;
        }

        .start-menu-item:hover {
            background: #e0e0e0;
        }

        .start-menu-item .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* Matopeli-ikkuna */
        #snake-window .window-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #snake-canvas {
            background-color: #333;
            border: 2px solid #555;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        #snake-controls {
            margin-top: 10px;
            font-size: 1.2em;
            font-weight: bold;
            color: #666;
            text-align: center;
        }

        #snake-score {
            margin-top: 10px;
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }

        /* Tiedostonhallinnan tyylit */
        .file-manager {
            display: flex;
            height: 100%;
        }
        
        .file-toolbar {
            background: #f0f0f0;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .file-toolbar button {
            padding: 5px 10px;
            background: #e0e0e0;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .file-toolbar button:hover {
            background: #d0d0d0;
        }
        
        .file-sidebar {
            width: 200px;
            background: #f8f8f8;
            border-right: 1px solid #ddd;
            padding: 10px;
        }
        
        .file-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .file-path {
            background: #fff;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
            color: #666;
        }
        
        .file-content {
            flex: 1;
            padding: 10px;
            background: #fff;
            overflow-y: auto;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 5px;
            margin-bottom: 2px;
            border-radius: 3px;
            cursor: pointer;
            user-select: none;
        }
        
        .file-item:hover {
            background: #e3f2fd;
        }
        
        .file-item.selected {
            background: #2196f3;
            color: white;
        }
        
        .file-item .icon {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .file-item .name {
            flex: 1;
            font-size: 13px;
        }
        
        .file-item .size {
            font-size: 11px;
            color: #666;
            margin-left: 10px;
        }
        
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-area:hover {
            border-color: #2196f3;
            color: #2196f3;
        }
        
        .file-upload-area.dragover {
            border-color: #4caf50;
            background: #f0fff0;
        }
        
        .sidebar-section {
            margin-bottom: 15px;
        }
        
        .sidebar-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }
        
        .sidebar-item {
            padding: 3px 0;
            cursor: pointer;
            font-size: 12px;
            color: #333;
        }
        
        .sidebar-item:hover {
            color: #2196f3;
        }
        
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 5px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* Kirjautumisn√§kym√§ */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10002;
            display: none;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 350px;
        }
        
        .login-logo {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .user-profiles {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .user-profile:hover {
            background: #e9ecef;
            border-color: #007bff;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-right: 15px;
        }
        
        .user-info {
            flex: 1;
            text-align: left;
        }
        
        .user-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }
        
        .user-type {
            font-size: 12px;
            color: #666;
        }
        
        .login-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .login-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .login-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .login-btn.primary:hover {
            background: #0056b3;
        }
        
        .login-btn.secondary {
            background: #6c757d;
            color: white;
        }
        
        .login-btn.secondary:hover {
            background: #545b62;
        }
        
        .current-user-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1001;
            display: none;
        }
        
        /* Uuden k√§ytt√§j√§n luominen */
        .create-user-form {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        /* P√§ivityslataus-tyylit */
        .update-progress-container {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .update-progress-bar-container {
            width: 100%;
            height: 25px;
            background-color: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #ced4da;
            margin: 10px 0;
        }
        
        .update-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .update-steps {
            margin: 10px 0;
            font-size: 13px;
        }
        
        .update-step {
            padding: 5px 0;
            color: #666;
        }
        
        .update-step.active {
            color: #28a745;
            font-weight: bold;
        }
        
        .update-step.completed {
            color: #6c757d;
        }
        
        .update-step::before {
            content: "‚è≥ ";
            margin-right: 5px;
        }
        
        .update-step.active::before {
            content: "üîÑ ";
        }
        
        .update-step.completed::before {
            content: "‚úÖ ";
        }
        #game-over-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            color: #333;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
        }
        .context-menu-item:hover {
            background: #f0f0f0;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body data-theme="blue">
    <!-- Kirjautumisn√§kym√§ -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">PigOS</div>
            <div class="login-subtitle">Valitse k√§ytt√§j√§ kirjautuaksesi</div>
            
            <div class="user-profiles" id="user-profiles">
                <!-- K√§ytt√§j√§profiilit lis√§t√§√§n t√§h√§n -->
            </div>
            
            <div class="login-actions">
                <button class="login-btn secondary" onclick="toggleCreateUser()">‚ûï Uusi k√§ytt√§j√§</button>
                <button class="login-btn secondary" onclick="rebootFromLogin()">üîÑ K√§ynnist√§ uudelleen</button>
                <button class="login-btn secondary" onclick="shutdownFromLogin()">‚èª Sammuta</button>
            </div>
            
            <!-- Uuden k√§ytt√§j√§n luomislomake -->
            <div class="create-user-form" id="create-user-form">
                <div class="form-group">
                    <label>K√§ytt√§j√§nimi:</label>
                    <input type="text" id="new-username" placeholder="Sy√∂t√§ k√§ytt√§j√§nimi">
                </div>
                <div class="form-group">
                    <label>Avatar:</label>
                    <select id="new-avatar">
                        <option value="üë§">üë§ Henkil√∂</option>
                        <option value="üê∑">üê∑ Sika</option>
                        <option value="ü§ñ">ü§ñ Robotti</option>
                        <option value="üë©">üë© Nainen</option>
                        <option value="üë®">üë® Mies</option>
                        <option value="ü¶Ñ">ü¶Ñ Yksisarvinen</option>
                        <option value="üê±">üê± Kissa</option>
                        <option value="üê∂">üê∂ Koira</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>K√§ytt√§j√§tyyppi:</label>
                    <select id="new-usertype">
                        <option value="user">Tavallinen k√§ytt√§j√§</option>
                        <option value="admin">J√§rjestelm√§nvalvoja</option>
                    </select>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="login-btn primary" onclick="createNewUser()">Luo k√§ytt√§j√§</button>
                    <button class="login-btn secondary" onclick="toggleCreateUser()">Peruuta</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Nykyisen k√§ytt√§j√§n tiedot -->
    <div class="current-user-info" id="current-user-info">
        <span id="current-user-display"></span>
    </div>

    <!-- BIOS-k√§ynnistysn√§ytt√∂ -->
    <div id="bios-screen">
        <div class="bios-content">
            <div class="bios-logo">PigOS BIOS</div>
            
            <div class="bios-line" style="animation-delay: 0.5s;">PigOS BIOS (Version 1.0.0)</div>
            <div class="bios-line" style="animation-delay: 1s;">CPU: PigOS Virtual CPU @ 3.2GHz</div>
            <div class="bios-line" style="animation-delay: 1.5s;">Memory: 8192MB OK</div>
            <div class="bios-line" style="animation-delay: 2s;">Storage: Virtual SSD 128GB</div>
            <div class="bios-line" style="animation-delay: 2.5s;">Initializing hardware...</div>
            <div class="bios-line" style="animation-delay: 3s;">Loading operating system...</div>
            
            <div class="progress-container">
                <div class="progress-bar" id="bios-progress"></div>
            </div>
            
            <div class="bios-line" style="animation-delay: 4s; margin-top: 20px;">Press F2 to enter SETUP</div>
            <div class="desktop-icon" onclick="openApp('snake')">
                <div class="icon-image">üêç</div>
                <div class="icon-label">Matopeli</div>
            </div>
        </div>
    </div>

    <!-- Logo animaatio -->
    <div class="logo-animation" id="logo-animation">
        <div class="logo">PigOS</div>
    </div>

    <!-- Sammutus/uudelleenk√§ynnistys n√§ytt√∂ -->
    <div id="shutdown-screen">
        <div id="shutdown-message">Sammutetaan...</div>
    </div>

    <!-- Normaali PigOS-k√§ytt√∂liittym√§ -->
    <div class="desktop" id="desktop" style="display: none;">
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openApp('settings')">
                <div class="icon-image">‚öôÔ∏è</div>
                <div class="icon-label">Asetukset</div>
            </div>
            <div class="desktop-icon" onclick="openApp('info')">
                <div class="icon-image">‚ÑπÔ∏è</div>
                <div class="icon-label">Tietoa</div>
            </div>
            <div class="desktop-icon" onclick="openApp('filemanager')">
                <div class="icon-image">üìÅ</div>
                <div class="icon-label">Tiedostot</div>
            </div>
        </div>
    </div>

    <div class="taskbar" id="taskbar" style="display: none;">
        <div class="taskbar-left">
            <button class="start-button" onclick="toggleStartMenu()">K√§ynnist√§</button>
        </div>
        <div class="taskbar-right">
            <span id="clock">00:00</span> | 
            <span id="version">v1.0.0</span>
            <button class="taskbar-button" id="volume-control" onclick="toggleMute()">üîä</button>
        </div>
    </div>

    <!-- K√§ynnist√§-valikko -->
    <div id="start-menu">
        <div class="start-menu-item" onclick="openApp('settings')">
            <div class="icon">‚öôÔ∏è</div>
            <div>Asetukset</div>
        </div>
        <div class="start-menu-item" onclick="openApp('info')">
            <div class="icon">‚ÑπÔ∏è</div>
            <div>Tietoa</div>
        </div>
        <div class="start-menu-item" onclick="openApp('filemanager')">
            <div class="icon">üìÅ</div>
            <div>Tiedostot</div>
        </div>
        <div class="start-menu-item" onclick="openApp('snake')">
            <div class="icon">üêç</div>
            <div>Matopeli</div>
        </div>
        <hr style="border: none; border-top: 1px solid #ddd; margin: 10px 0;">
        <div class="start-menu-item" onclick="toggleCreateUser()">
            <div class="icon">‚ûï</div>
            <div>Luo k√§ytt√§j√§</div>
        </div>
        <div class="start-menu-item" onclick="UserManager.logout()">
            <div class="icon">üë§</div>
            <div>Kirjaudu ulos</div>
        </div>
        <div class="start-menu-item" onclick="rebootSystem()">
            <div class="icon">üîÑ</div>
            <div>K√§ynnist√§ uudelleen</div>
        </div>
        <div class="start-menu-item" onclick="shutdownSystem()">
            <div class="icon">‚èª</div>
            <div>Sammuta</div>
        </div>
    </div>

    <!-- Asetukset-ikkuna -->
    <div class="window" id="settings-window">
        <div class="window-header">
            <div class="window-title">‚öôÔ∏è Asetukset</div>
            <div class="window-controls">
                <button onclick="closeApp('settings')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <h2>J√§rjestelm√§n asetukset</h2>
            
            <div class="setting-item" style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                <h3>üíæ Tallennustila</h3>
                <p>Seuraa tallennustilan k√§ytt√∂√§</p>
                <div id="storage-info" style="margin: 15px 0;">
                    <!-- Tallennustilan tiedot render√∂id√§√§n t√§h√§n -->
                </div>
                <button onclick="updateStorageInfo()" style="background: #28a745; color: white; padding: 8px 16px; 
                border: none; border-radius: 4px; cursor: pointer; margin: 5px 0;">
                    üîÑ P√§ivit√§ tiedot
                </button>
                <button onclick="clearUserData()" style="background: #dc3545; color: white; padding: 8px 16px; 
                border: none; border-radius: 4px; cursor: pointer; margin: 5px 0 5px 10px;">
                    üóëÔ∏è Tyhjenn√§ tiedot
                </button>
            </div>
            
            <div class="setting-item" style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                <h3>üîÑ J√§rjestelm√§n p√§ivitykset</h3>
                <p>Tarkista uudet p√§ivitykset GitHubista</p>
                
                <button onclick="checkForUpdates()" style="background: #2E86C1; color: white; padding: 12px 24px; 
                border: none; border-radius: 6px; cursor: pointer; margin: 10px 0; font-size: 16px;">
                    üì° Tarkista p√§ivitykset
                </button>
                
                <div id="update-info" style="margin: 15px 0; padding: 12px; background: #e8f4fc; border-radius: 5px; border-left: 4px solid #2E86C1;">
                    <p>P√§ivityksi√§ ei ole tarkistettu</p>
                    <div style="font-size: 12px; color: #666; margin-top: 10px;">
                        <p><strong>‚úÖ GitHub-repositorio konfiguroitu:</strong></p>
                        <code style="background: #f1f1f1; padding: 2px 4px; border-radius: 3px;">
                            github.com/sikasaatana/PigOS-Project
                        </code>
                    </div>
                </div>
                
                <div style="font-size: 14px; color: #666;">
                    <p>üìä Nykyinen versio: <strong id="current-version">v1.0.0</strong></p>
                    <p>üÜï Viimeisin versio: <strong id="latest-version">-</strong></p>
                </div>
            </div>
            
            <div class="setting-item" style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                <h3>üé® Ulkoasu</h3>
                <label>Teema:</label>
                <select id="theme-select" onchange="changeTheme(this.value)" style="padding: 8px; margin: 10px 0; border-radius: 4px; border: 1px solid #ddd;">
                    <option value="blue">Sininen</option>
                    <option value="dark">Tumma</option>
                    <option value="light">Vaalea</option>
                </select>
            </div>
            
            <div class="setting-item" style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                <h3>üìù P√§ivitysloki</h3>
                <p>Tarkastele asennettuja j√§rjestelm√§p√§ivityksi√§:</p>
                <div id="update-log-container" style="margin-top: 15px;">
                    <!-- P√§ivitysloki render√∂id√§√§n t√§h√§n -->
                    <p style="color: #999;">P√§ivityksi√§ ei ole viel√§ asennettu.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tietoa-ikkuna -->
    <div class="window" id="info-window">
        <div class="window-header">
            <div class="window-title">‚ÑπÔ∏è Tietoa PigOS:ista</div>
            <div class="window-controls">
                <button onclick="closeApp('info')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <h2>PigOS v1.0.0</h2>
            <p>HTML-pohjainen k√§ytt√∂j√§rjestelm√§</p>
            
            <div style="margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 8px;">
                <h3>üì¶ Ominaisuudet:</h3>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>GitHub-pohjaiset p√§ivitykset</li>
                    <li>Teemavaihto</li>
                    <li>Ty√∂p√∂yt√§ymp√§rist√∂</li>
                    <li>Asetusvalikko</li>
                    <li>BIOS-k√§ynnistysn√§ytt√∂</li>
                    <li>Logo-animaatio</li>
                </ul>
            </div>
            
            <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                <h3>üìÑ P√§ivitysohjeet:</h3>
                <p>P√§ivitykset tarkistetaan manuaalisesti asetuksista.</p>
                <p>Uusi versio latautuu automaattisesti GitHubista.</p>
            </div>
        </div>
    </div>

    <!-- Matopeli-ikkuna -->
    <div class="window" id="snake-window">
        <div class="window-header">
            <div class="window-title">üêç Matopeli</div>
            <div class="window-controls">
                <button onclick="closeApp('snake')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <canvas id="snake-canvas" width="400" height="400"></canvas>
            <div id="snake-controls">
                <p>K√§yt√§ nuolin√§pp√§imi√§. Sy√∂ ruokaa!</p>
                <p id="snake-score">Pisteet: 0</p>
            </div>
            <div id="game-over-message" style="display: none;">
                <p>Peli ohi!</p>
                <p id="final-score"></p>
                <button onclick="restartSnakeGame()">Aloita uudelleen</button>
            </div>
        </div>
    </div>
    
    <!-- Tiedostonhallinta-ikkuna -->
    <div class="window" id="filemanager-window">
        <div class="window-header">
            <div class="window-title">üìÅ Tiedostot</div>
            <div class="window-controls">
                <button onclick="closeApp('filemanager')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content" style="padding: 0;">
            <div class="file-manager">
                <div class="file-sidebar">
                    <div class="sidebar-section">
                        <div class="sidebar-title">Sijainnit</div>
                        <div class="sidebar-item" onclick="navigateToFolder('desktop')">üñ•Ô∏è Ty√∂p√∂yt√§</div>
                        <div class="sidebar-item" onclick="navigateToFolder('documents')">üìÑ Asiakirjat</div>
                        <div class="sidebar-item" onclick="navigateToFolder('downloads')">‚¨áÔ∏è Lataukset</div>
                        <div class="sidebar-item" onclick="navigateToFolder('passwords')">üîê Salasanat</div>
                        <div class="sidebar-item" onclick="navigateToFolder('pictures')">üñºÔ∏è Kuvat</div>
                        <div class="sidebar-item" onclick="navigateToFolder('passwords')">üîê Salasanat</div>
                    </div>
                    <div class="sidebar-section">
                        <div class="sidebar-title">Toiminnot</div>
                        <div class="sidebar-item" onclick="createNewFolder()">üìÅ Uusi kansio</div>
                        <div class="sidebar-item" onclick="uploadFile()">‚¨ÜÔ∏è Lataa tiedosto</div>
                    </div>
                </div>
                <div class="file-main">
                    <div class="file-toolbar">
                        <button onclick="goBack()">‚Üê Takaisin</button>
                        <button onclick="goForward()">Eteenp√§in ‚Üí</button>
                        <button onclick="refreshFolder()">üîÑ P√§ivit√§</button>
                        <button onclick="createNewFolder()">üìÅ Uusi kansio</button>
                        <button onclick="deleteSelected()">üóëÔ∏è Poista</button>
                    </div>
                    <div class="file-path" id="current-path">üìÅ Ty√∂p√∂yt√§</div>
                    <div class="file-content" id="file-content">
                        <div class="file-upload-area" id="upload-area">
                            <p>üìÅ Ved√§ tiedostoja t√§h√§n tai klikkaa ladataksesi</p>
                            <input type="file" id="file-input" multiple style="display: none;">
                        </div>
                        <div id="file-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- K√§ytt√§j√§nluomisikkuna -->
    <div class="window" id="create-user-window">
        <div class="window-header">
            <div class="window-title">‚ûï Luo uusi k√§ytt√§j√§</div>
            <div class="window-controls">
                <button onclick="closeApp('create-user')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <h2>Uuden k√§ytt√§j√§n luominen</h2>
            <p style="color: #666; margin-bottom: 20px;">Luo oma henkil√∂kohtainen k√§ytt√§j√§tilin 5MB tallennustilalla.</p>
            
            <div class="form-group">
                <label>K√§ytt√§j√§nimi:</label>
                <input type="text" id="new-username" placeholder="Sy√∂t√§ k√§ytt√§j√§nimi" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px; margin-top: 5px;">
            </div>
            <div class="form-group">
                <label>Avatar:</label>
                <select id="new-avatar" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px; margin-top: 5px;">
                    <option value="üë§">üë§ Henkil√∂</option>
                    <option value="üë©">üë© Nainen</option>
                    <option value="üë®">üë® Mies</option>
                    <option value="üê∑">üê∑ Sika</option>
                    <option value="ü§ñ">ü§ñ Robotti</option>
                    <option value="ü¶Ñ">ü¶Ñ Yksisarvinen</option>
                    <option value="üê±">üê± Kissa</option>
                    <option value="üê∂">üê∂ Koira</option>
                    <option value="üê∏">üê∏ Sammakko</option>
                    <option value="ü¶ä">ü¶ä Kettu</option>
                </select>
            </div>
            <div class="form-group">
                <label>K√§ytt√§j√§tyyppi:</label>
                <select id="new-usertype" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px; margin-top: 5px;">
                    <option value="user">Tavallinen k√§ytt√§j√§</option>
                    <option value="admin">J√§rjestelm√§nvalvoja</option>
                </select>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="createNewUser()" style="background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                    ‚úÖ Luo k√§ytt√§j√§
                </button>
                <button onclick="closeApp('create-user')" style="background: #6c757d; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
                    ‚ùå Peruuta
                </button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                <h4 style="margin-top: 0;">üí° Mit√§ saat:</h4>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>5MB henkil√∂kohtaista tallennustilaa</li>
                    <li>Omat kansiot (Ty√∂p√∂yt√§, Asiakirjat, Kuvat, Salasanat)</li>
                    <li>Mahdollisuus tallentaa tekstitiedostoja</li>
                    <li>Salasanojen turvallinen tallennus</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Kontekstivalikko -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" onclick="openFile()">üìÇ Avaa</div>
        <div class="context-menu-item" onclick="renameFile()">‚úèÔ∏è Nime√§ uudelleen</div>
        <div class="context-menu-item" onclick="deleteFile()">üóëÔ∏è Poista</div>
        <div class="context-menu-item" onclick="getFileInfo()">‚ÑπÔ∏è Ominaisuudet</div>
    </div>
    
    <!-- Yleinen ilmoitusikkuna -->
    <div class="window" id="message-box-window">
        <div class="window-header">
            <div class="window-title" id="message-box-title">Ilmoitus</div>
            <div class="window-controls">
                <button onclick="closeApp('message-box')" style="background: #ff4757; color: white; border: none; 
                border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div class="window-content">
            <p id="message-box-content"></p>
            <button onclick="closeApp('message-box')">OK</button>
        </div>
    </div>

    <!-- JavaScript-koodi -->
    <script>
        // BIOS-k√§ynnistyssekvenssi
        document.addEventListener('DOMContentLoaded', function() {
            // Lataa tallennetut asetukset heti
            loadSavedSettings();
            
            // Alusta √§√§niefektit
            PigOSAudio.init();
            
            // Alusta k√§ytt√§j√§j√§rjestelm√§
            UserManager.init();
            
            // BIOS-ty√∂palkin animointi
            setTimeout(function() {
                document.getElementById('bios-progress').style.width = '25%';
            }, 3500);
            
            setTimeout(function() {
                document.getElementById('bios-progress').style.width = '50%';
            }, 4000);
            
            setTimeout(function() {
                document.getElementById('bios-progress').style.width = '75%';
            }, 4500);
            
            setTimeout(function() {
                document.getElementById('bios-progress').style.width = '100%';
            }, 5000);
            
            // Piilota BIOS-n√§ytt√∂ ja n√§yt√§ logo-animaatio
            setTimeout(function() {
                document.getElementById('bios-screen').style.display = 'none';
                document.getElementById('logo-animation').classList.add('visible');
            }, 5500);
            
            // Piilota logo-animaatio ja n√§yt√§ ty√∂p√∂yt√§
            setTimeout(function() {
                document.getElementById('logo-animation').classList.remove('visible');
                
                // Jos ei ole kirjautunut k√§ytt√§j√§√§, n√§yt√§ kirjautumisn√§kym√§
                if (!UserManager.currentUser) {
                    // Kokeile automaattista kirjautumista
                    UserManager.autoLogin();
                } else {
                    // N√§yt√§ ty√∂p√∂yt√§ jos k√§ytt√§j√§ on jo kirjautunut
                    document.getElementById('desktop').style.display = 'block';
                    document.getElementById('taskbar').style.display = 'flex';
                    UserManager.showCurrentUser();
                }
                
                // Soita k√§ynnistys√§√§ni kun j√§rjestelm√§ on valmis
                setTimeout(() => {
                    PigOSAudio.playStartupSound();
                }, 500);
            }, 7500);
        });

        // K√§ytt√§j√§hallintaj√§rjestelm√§
        const UserManager = {
            currentUser: null,
            users: [],
            
            // Alusta k√§ytt√§j√§j√§rjestelm√§
            init: function() {
                this.loadUsers();
                if (this.users.length === 0) {
                    // Luo oletusk√§ytt√§j√§t jos ei ole yht√§√§n
                    this.createDefaultUsers();
                }
                this.showLoginScreen();
            },
            
            // Luo oletusk√§ytt√§j√§t
            createDefaultUsers: function() {
                const defaultUsers = [
                    {id: 'admin', username: 'J√§rjestelm√§nvalvoja', avatar: 'ü§ñ', type: 'admin', created: new Date().toISOString()}
                ];
                
                defaultUsers.forEach(user => {
                    this.users.push(user);
                    // Luo k√§ytt√§j√§kohtainen tiedostoj√§rjestelm√§
                    this.createUserFileSystem(user.id);
                });
                
                this.saveUsers();
            },
            
            // Luo k√§ytt√§j√§kohtainen tiedostoj√§rjestelm√§
            createUserFileSystem: function(userId) {
                const userPrefix = userId + '_';
                const userName = this.users.find(u => u.id === userId)?.username || userId;
                
                FileSystem.folders[userPrefix + 'desktop'] = {
                    name: 'Ty√∂p√∂yt√§',
                    files: [
                        {name: `Tervetuloa.txt`, type: 'text', size: '1.0 KB', content: `Tervetuloa PigOS:iin, ${userName}!\n\nT√§m√§ on sinun henkil√∂kohtainen ty√∂p√∂yt√§si.\n\nTallennustila: 5MB\nVoit tallentaa:\n- Tekstitiedostoja\n- K√§ytt√§j√§tunnuksia\n- Omia tiedostojasi\n\nNauti PigOS:n k√§yt√∂st√§!`},
                        {name: 'Tallennustila.txt', type: 'text', size: '0.5 KB', content: 'PigOS Tallennustila\n\nSinulla on 5MB tallennustilaa k√§yt√∂ss√§si.\nVoit tarkistaa k√§ytetyn tilan asetuksista.'}
                    ],
                    folders: [userPrefix + 'documents', userPrefix + 'pictures', userPrefix + 'downloads', userPrefix + 'passwords']
                };
                
                FileSystem.folders[userPrefix + 'documents'] = {name: 'Asiakirjat', files: [], folders: []};
                FileSystem.folders[userPrefix + 'pictures'] = {name: 'Kuvat', files: [], folders: []};
                FileSystem.folders[userPrefix + 'downloads'] = {name: 'Lataukset', files: [], folders: []};
                FileSystem.folders[userPrefix + 'passwords'] = {
                    name: 'Salasanat', 
                    files: [
                        {name: 'Salasana-ohje.txt', type: 'text', size: '0.8 KB', content: 'Salasanojen tallentaminen\n\nVoit tallentaa k√§ytt√§j√§tunnuksia ja salasanoja turvallisesti t√§h√§n kansioon.\n\nMuista:\n- √Ñl√§ jaa salasanojasi\n- K√§yt√§ vahvoja salasanoja\n- Vaihda salasanoja s√§√§nn√∂llisesti'}
                    ], 
                    folders: []
                };
            },
            
            // N√§yt√§ kirjautumisn√§kym√§
            showLoginScreen: function() {
                this.renderUserProfiles();
                document.getElementById('login-screen').style.display = 'flex';
            },
            
            // Piirr√§ k√§ytt√§j√§profiilit
            renderUserProfiles: function() {
                const container = document.getElementById('user-profiles');
                container.innerHTML = '';
                
                this.users.forEach(user => {
                    const userElement = document.createElement('div');
                    userElement.className = 'user-profile';
                    userElement.innerHTML = `
                        <div class="user-avatar">${user.avatar}</div>
                        <div class="user-info">
                            <div class="user-name">${user.username}</div>
                            <div class="user-type">${user.type === 'admin' ? 'J√§rjestelm√§nvalvoja' : 'K√§ytt√§j√§'}</div>
                        </div>
                    `;
                    
                    userElement.addEventListener('click', () => {
                        this.loginUser(user);
                    });
                    
                    container.appendChild(userElement);
                });
            },
            
            // Kirjaa k√§ytt√§j√§ sis√§√§n
            loginUser: function(user) {
                this.currentUser = user;
                PigOSAudio.playSuccessSound();
                
                // Vaihda tiedostoj√§rjestelm√§ k√§ytt√§j√§kohtaiseksi
                this.switchToUserFileSystem(user.id);
                
                // Piilota kirjautumisn√§kym√§
                document.getElementById('login-screen').style.display = 'none';
                
                // N√§yt√§ k√§ytt√§j√§tiedot
                this.showCurrentUser();
                
                // Tallenna viimeisin kirjautuminen
                PigOSStorage.save('lastUser', user.id);
                
                console.log('K√§ytt√§j√§ kirjautunut:', user.username);
            },
            
            // Vaihda k√§ytt√§j√§kohtaiseen tiedostoj√§rjestelm√§√§n
            switchToUserFileSystem: function(userId) {
                const userPrefix = userId + '_';
                FileSystem.currentPath = userPrefix + 'desktop';
                FileSystem.history = [userPrefix + 'desktop'];
                FileSystem.historyIndex = 0;
            },
            
            // N√§yt√§ nykyisen k√§ytt√§j√§n tiedot
            showCurrentUser: function() {
                if (this.currentUser) {
                    const display = document.getElementById('current-user-display');
                    display.textContent = `${this.currentUser.avatar} ${this.currentUser.username}`;
                    document.getElementById('current-user-info').style.display = 'block';
                }
            },
            
            // Luo uusi k√§ytt√§j√§
            createUser: function(username, avatar, usertype) {
                if (!username.trim()) {
                    alert('K√§ytt√§j√§nimi ei voi olla tyhj√§!');
                    return false;
                }
                
                // Tarkista ett√§ k√§ytt√§j√§nimi on uniikki
                if (this.users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
                    alert('K√§ytt√§j√§nimi on jo k√§yt√∂ss√§!');
                    return false;
                }
                
                const userId = 'user_' + Date.now();
                const newUser = {
                    id: userId,
                    username: username.trim(),
                    avatar: avatar,
                    type: usertype,
                    created: new Date().toISOString()
                };
                
                this.users.push(newUser);
                this.createUserFileSystem(userId);
                this.saveUsers();
                this.renderUserProfiles();
                
                PigOSAudio.playSuccessSound();
                return true;
            },
            
            // Kirjaa ulos
            logout: function() {
                this.currentUser = null;
                document.getElementById('current-user-info').style.display = 'none';
                this.showLoginScreen();
                PigOSStorage.remove('lastUser');
                PigOSAudio.playClickSound();
            },
            
            // Tallenna k√§ytt√§j√§t ja tiedostoj√§rjestelm√§
            saveUsers: function() {
                PigOSStorage.save('users', this.users);
                // Tallenna my√∂s tiedostoj√§rjestelm√§
                PigOSStorage.save('fileSystem', FileSystem.folders);
                console.log('K√§ytt√§j√§t ja tiedostot tallennettu');
            },
            
            // Lataa k√§ytt√§j√§t ja tiedostoj√§rjestelm√§
            loadUsers: function() {
                this.users = PigOSStorage.load('users', []);
                
                // Lataa my√∂s tiedostoj√§rjestelm√§
                const savedFileSystem = PigOSStorage.load('fileSystem', null);
                if (savedFileSystem) {
                    // Yhdist√§ tallennetut tiedostot olemassa oleviin
                    Object.keys(savedFileSystem).forEach(key => {
                        FileSystem.folders[key] = savedFileSystem[key];
                    });
                    console.log('Tiedostoj√§rjestelm√§ ladattu');
                }
            },
            
            // Automaattinen kirjautuminen p√§ivityksen j√§lkeen
            autoLogin: function() {
                const lastUserId = PigOSStorage.load('lastUser');
                const updateUserId = PigOSStorage.load('updateUser');
                const updateTimestamp = PigOSStorage.load('updateTimestamp');
                
                // Jos on p√§ivityksen j√§lkeinen kirjautuminen
                if (updateUserId && updateTimestamp) {
                    const updateTime = new Date(updateTimestamp);
                    const now = new Date();
                    const timeDiff = now - updateTime;
                    
                    // Jos p√§ivitys on alle 5 minuuttia sitten
                    if (timeDiff < 5 * 60 * 1000) {
                        const user = this.users.find(u => u.id === updateUserId);
                        if (user) {
                            // N√§yt√§ p√§ivitysilmoitus
                            setTimeout(() => {
                                this.showUpdateSuccessMessage();
                                this.loginUser(user);
                            }, 2000);
                            
                            // Poista p√§ivitysmerkinn√§t
                            PigOSStorage.remove('updateUser');
                            PigOSStorage.remove('updateTimestamp');
                            return;
                        }
                    }
                }
                
                // Normaali automaattinen kirjautuminen
                if (lastUserId) {
                    const user = this.users.find(u => u.id === lastUserId);
                    if (user) {
                        setTimeout(() => {
                            this.loginUser(user);
                        }, 1000);
                    }
                }
            },
            
            // N√§yt√§ p√§ivityksen onnistumisviesti
            showUpdateSuccessMessage: function() {
                // Luo ilmoitusikkuna
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #28a745, #20c997);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
                    z-index: 10000;
                    max-width: 300px;
                    font-family: 'Segoe UI', sans-serif;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="font-size: 24px; margin-right: 10px;">‚úÖ</span>
                        <strong style="font-size: 16px;">PigOS p√§ivitetty!</strong>
                    </div>
                    <div style="font-size: 14px; opacity: 0.9;">
                        J√§rjestelm√§ on nyt uusimmassa versiossa.<br>
                        Nauti uusista ominaisuuksista!
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Soita onnistumismelodia
                PigOSAudio.playSuccessSound();
                
                // Poista ilmoitus 5 sekunnin kuluttua
                setTimeout(() => {
                    notification.style.transition = 'all 0.5s ease';
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 5000);
            }
        };
        const FileSystem = {
            currentPath: 'desktop',
            selectedFile: null,
            history: ['desktop'],
            historyIndex: 0,
            
            // Virtuaaliset kansiot ja tiedostot
            folders: {
                desktop: {
                    name: 'Ty√∂p√∂yt√§',
                    files: [
                        {name: 'Tervetuloa.txt', type: 'text', size: '1.2 KB', content: 'Tervetuloa PigOS:iin!\nT√§m√§ on virtuaalinen tiedostoj√§rjestelm√§.'},
                        {name: 'Tietoa.txt', type: 'text', size: '0.8 KB', content: 'PigOS v1.0.0\nHTML-pohjainen k√§ytt√∂j√§rjestelm√§'},
                    ],
                    folders: ['documents', 'pictures']
                },
                documents: {
                    name: 'Asiakirjat',
                    files: [
                        {name: 'Asetukset.txt', type: 'text', size: '0.5 KB', content: 'J√§rjestelm√§asetukset tallennetaan automaattisesti.'},
                    ],
                    folders: []
                },
                downloads: {
                    name: 'Lataukset',
                    files: [],
                    folders: []
                },
                pictures: {
                    name: 'Kuvat',
                    files: [],
                    folders: []
                }
            },
            
            // Navigoi kansioon
            navigateTo: function(folderName) {
                if (this.folders[folderName]) {
                    this.currentPath = folderName;
                    
                    // P√§ivit√§ historia
                    this.history = this.history.slice(0, this.historyIndex + 1);
                    this.history.push(folderName);
                    this.historyIndex = this.history.length - 1;
                    
                    this.refreshView();
                    PigOSAudio.playClickSound();
                }
            },
            
            // Mene takaisin
            goBack: function() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.currentPath = this.history[this.historyIndex];
                    this.refreshView();
                    PigOSAudio.playClickSound();
                }
            },
            
            // Mene eteenp√§in
            goForward: function() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.currentPath = this.history[this.historyIndex];
                    this.refreshView();
                    PigOSAudio.playClickSound();
                }
            },
            
            // Luo uusi kansio
            createFolder: function(name) {
                if (!name) name = prompt('Anna kansion nimi:');
                if (name && !this.folders[this.currentPath + '_' + name]) {
                    const folderId = this.currentPath + '_' + name;
                    this.folders[folderId] = {
                        name: name,
                        files: [],
                        folders: []
                    };
                    this.folders[this.currentPath].folders.push(folderId);
                    this.refreshView();
                    PigOSAudio.playSuccessSound();
                    
                    // Tallenna muutokset
                    UserManager.saveUsers();
                }
            },
            
            // Lis√§√§ tiedosto
            addFile: function(file) {
                const currentFolder = this.folders[this.currentPath];
                const fileObj = {
                    name: file.name,
                    type: this.getFileType(file.name),
                    size: this.formatFileSize(file.size),
                    content: null,
                    realFile: file
                };
                
                // Lue tiedoston sis√§lt√∂ jos se on teksti
                if (file.type.startsWith('text/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        fileObj.content = e.target.result;
                        // Tallenna tiedostoj√§rjestelm√§ kun sis√§lt√∂ on ladattu
                        UserManager.saveUsers();
                    };
                    reader.readAsText(file);
                }
                
                currentFolder.files.push(fileObj);
                this.refreshView();
                PigOSAudio.playSuccessSound();
                
                // Tallenna muutokset
                UserManager.saveUsers();
            },
            
            // Poista tiedosto
            deleteFile: function(fileName) {
                if (confirm(`Haluatko varmasti poistaa tiedoston "${fileName}"?`)) {
                    const currentFolder = this.folders[this.currentPath];
                    currentFolder.files = currentFolder.files.filter(f => f.name !== fileName);
                    this.refreshView();
                    PigOSAudio.playClickSound();
                    
                    // Tallenna muutokset
                    UserManager.saveUsers();
                }
            },
            
            // P√§ivit√§ n√§kym√§
            refreshView: function() {
                const pathElement = document.getElementById('current-path');
                const listElement = document.getElementById('file-list');
                const currentFolder = this.folders[this.currentPath];
                
                pathElement.textContent = `üìÅ ${currentFolder.name}`;
                listElement.innerHTML = '';
                
                // N√§yt√§ kansiot
                currentFolder.folders.forEach(folderId => {
                    const folder = this.folders[folderId];
                    const item = this.createFileItem(folder.name, 'folder', '', folderId);
                    listElement.appendChild(item);
                });
                
                // N√§yt√§ tiedostot
                currentFolder.files.forEach(file => {
                    const item = this.createFileItem(file.name, file.type, file.size, null);
                    listElement.appendChild(item);
                });
            },
            
            // Luo tiedosto-elementti
            createFileItem: function(name, type, size, folderId) {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span class="icon">${this.getFileIcon(type)}</span>
                    <span class="name">${name}</span>
                    <span class="size">${size}</span>
                `;
                
                item.addEventListener('click', () => {
                    // Poista aiempi valinta
                    document.querySelectorAll('.file-item').forEach(el => el.classList.remove('selected'));
                    item.classList.add('selected');
                    this.selectedFile = {name, type, size, folderId};
                });
                
                item.addEventListener('dblclick', () => {
                    if (folderId) {
                        this.navigateTo(folderId);
                    } else {
                        this.openFile(name);
                    }
                });
                
                item.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e.clientX, e.clientY, name, type);
                });
                
                return item;
            },
            
            // Hae tiedostotyypin ikoni
            getFileIcon: function(type) {
                const icons = {
                    folder: 'üìÅ',
                    text: 'üìÑ',
                    image: 'üñºÔ∏è',
                    audio: 'üéµ',
                    video: 'üé¨',
                    pdf: 'üìï',
                    zip: 'üì¶'
                };
                return icons[type] || 'üìÑ';
            },
            
            // M√§√§rit√§ tiedostotyyppi
            getFileType: function(fileName) {
                const ext = fileName.split('.').pop().toLowerCase();
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp'].includes(ext)) return 'image';
                if (['mp3', 'wav', 'ogg'].includes(ext)) return 'audio';
                if (['mp4', 'avi', 'mov'].includes(ext)) return 'video';
                if (['pdf'].includes(ext)) return 'pdf';
                if (['zip', 'rar', '7z'].includes(ext)) return 'zip';
                return 'text';
            },
            
            // Muotoile tiedostokoko
            formatFileSize: function(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            },
            
            // N√§yt√§ kontekstivalikko
            showContextMenu: function(x, y, fileName, fileType) {
                const menu = document.getElementById('context-menu');
                menu.style.left = x + 'px';
                menu.style.top = y + 'px';
                menu.style.display = 'block';
                this.selectedFile = {name: fileName, type: fileType};
            },
            
            // Avaa tiedosto
            openFile: function(fileName) {
                const file = this.folders[this.currentPath].files.find(f => f.name === fileName);
                if (file && file.content) {
                    alert(`${file.name}:\n\n${file.content}`);
                } else {
                    alert(`Tiedostoa "${fileName}" ei voida avata.`);
                }
                PigOSAudio.playClickSound();
            }
        };
        const PigOSAudio = {
            // Web Audio API konteksti
            audioContext: null,
            
            init: function() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('√Ñ√§niefektit alustettu');
                    return true;
                } catch (error) {
                    console.log('√Ñ√§niefektit eiv√§t ole tuettuja');
                    return false;
                }
            },
            
            // Soita s√§vel tietyll√§ taajuudella ja kestolla
            playTone: function(frequency, duration, volume = 0.3) {
                if (!this.audioContext || isMuted) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square'; // Retro-tyylinen square wave
                
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            },
            
            // K√§ynnistysmelodia
            playStartupSound: function() {
                if (isMuted) return;
                
                const melody = [
                    {freq: 523, duration: 0.2}, // C5
                    {freq: 659, duration: 0.2}, // E5
                    {freq: 784, duration: 0.2}, // G5
                    {freq: 1047, duration: 0.4}, // C6
                    {freq: 784, duration: 0.2}, // G5
                    {freq: 1047, duration: 0.6}  // C6 (pidempi)
                ];
                
                let delay = 0;
                melody.forEach((note, index) => {
                    setTimeout(() => {
                        this.playTone(note.freq, note.duration, 0.2);
                    }, delay * 1000);
                    delay += note.duration + 0.05; // Pieni tauko s√§velien v√§lill√§
                });
                
                console.log('K√§ynnistys√§√§ni soitettu');
            },
            
            // Klikkaus√§√§ni
            playClickSound: function() {
                if (isMuted) return;
                this.playTone(800, 0.05, 0.1);
            },
            
            // Virhe√§√§ni
            playErrorSound: function() {
                if (isMuted) return;
                this.playTone(200, 0.3, 0.15);
            },
            
            // Onnistumis√§√§ni
            playSuccessSound: function() {
                if (isMuted) return;
                setTimeout(() => this.playTone(523, 0.1, 0.1), 0);
                setTimeout(() => this.playTone(659, 0.1, 0.1), 100);
                setTimeout(() => this.playTone(784, 0.2, 0.1), 200);
            }
        };
        const PigOSStorage = {
            save: function(key, value) {
                try {
                    // K√§yt√§ in-memory storagea LocalStoragen sijaan
                    if (!window.pigOSData) window.pigOSData = {};
                    window.pigOSData[key] = JSON.stringify(value);
                    console.log(`Tallennettu: ${key} = ${value}`);
                    return true;
                } catch (error) {
                    console.error('Tallennusvirhe:', error);
                    return false;
                }
            },
            
            load: function(key, defaultValue = null) {
                try {
                    if (!window.pigOSData) window.pigOSData = {};
                    const value = window.pigOSData[key];
                    if (value !== undefined) {
                        return JSON.parse(value);
                    }
                    return defaultValue;
                } catch (error) {
                    console.error('Latausvirhe:', error);
                    return defaultValue;
                }
            },
            
            remove: function(key) {
                try {
                    if (!window.pigOSData) window.pigOSData = {};
                    delete window.pigOSData[key];
                    return true;
                } catch (error) {
                    console.error('Poistamisvirhe:', error);
                    return false;
                }
            },
            
            clear: function() {
                try {
                    window.pigOSData = {};
                    return true;
                } catch (error) {
                    console.error('Tyhjennysvirhe:', error);
                    return false;
                }
            }
        };

        // Lataa tallennetut asetukset k√§ynnistyksess√§
        function loadSavedSettings() {
            // Lataa teema
            const savedTheme = PigOSStorage.load('theme', 'blue');
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-select').value = savedTheme;
            
            // Lataa √§√§niasetukset
            const savedMute = PigOSStorage.load('muted', false);
            isMuted = savedMute;
            document.getElementById('volume-control').textContent = isMuted ? 'üîá' : 'üîä';
            
            // Lataa ikkunoiden sijainnit
            const savedPositions = PigOSStorage.load('windowPositions', {});
            window.savedWindowPositions = savedPositions;
            
            console.log('Asetukset ladattu:', {
                theme: savedTheme,
                muted: savedMute,
                positions: Object.keys(savedPositions).length
            });
        }

        // Tallenna ikkunan sijainti kun sit√§ liikutetaan
        function saveWindowPosition(windowName, x, y) {
            if (!window.savedWindowPositions) window.savedWindowPositions = {};
            window.savedWindowPositions[windowName] = { x: x, y: y };
            PigOSStorage.save('windowPositions', window.savedWindowPositions);
        }

        // Palauta ikkunan sijainti
        function restoreWindowPosition(windowElement, windowName) {
            const savedPositions = PigOSStorage.load('windowPositions', {});
            if (savedPositions[windowName]) {
                const pos = savedPositions[windowName];
                windowElement.style.left = pos.x + 'px';
                windowElement.style.top = pos.y + 'px';
                windowElement.style.transform = 'none';
            }
        }
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }
        
        setInterval(updateClock, 1000);
        updateClock();

        // Sovellusten hallinta
        function openApp(appName) {
            const window = document.getElementById(`${appName}-window`);
            window.style.display = 'flex';
            
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
            
            // Palauta tallennettu sijainti
            restoreWindowPosition(window, appName);
            
            if (appName === 'snake') {
                initSnakeGame();
            } else if (appName === 'filemanager') {
                initFileManager();
            } else if (appName === 'settings') {
                updateStorageInfo();
            }
            // Tee ikkuna vedett√§v√§ksi
            makeDraggable(window, appName);
        }

        function closeApp(appName) {
            document.getElementById(`${appName}-window`).style.display = 'none';
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
            
            if (appName === 'snake') {
                snakeGameActive = false;
            }
        }

        // Tiedostonhallinnan funktiot
        function initFileManager() {
            FileSystem.refreshView();
            setupFileUpload();
        }
        
        function navigateToFolder(folderName) {
            FileSystem.navigateTo(folderName);
        }
        
        function goBack() {
            FileSystem.goBack();
        }
        
        function goForward() {
            FileSystem.goForward();
        }
        
        function refreshFolder() {
            FileSystem.refreshView();
            PigOSAudio.playClickSound();
        }
        
        function createNewFolder() {
            FileSystem.createFolder();
        }
        
        function deleteSelected() {
            if (FileSystem.selectedFile) {
                FileSystem.deleteFile(FileSystem.selectedFile.name);
            }
        }
        
        function uploadFile() {
            document.getElementById('file-input').click();
        }
        
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            
            // Klikkaus lataus
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // Tiedoston valinta
            fileInput.addEventListener('change', (e) => {
                Array.from(e.target.files).forEach(file => {
                    FileSystem.addFile(file);
                });
            });
            
            // Drag & drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                Array.from(e.dataTransfer.files).forEach(file => {
                    FileSystem.addFile(file);
                });
            });
        }
        
        // Kontekstivalikon funktiot
        function openFile() {
            if (FileSystem.selectedFile) {
                FileSystem.openFile(FileSystem.selectedFile.name);
            }
            hideContextMenu();
        }
        
        function renameFile() {
            if (FileSystem.selectedFile) {
                const newName = prompt('Anna uusi nimi:', FileSystem.selectedFile.name);
                if (newName) {
                    // Toteuta nime√§minen uudelleen
                    alert('Uudelleennime√§minen tulossa my√∂hemm√§ss√§ versiossa!');
                }
            }
            hideContextMenu();
        }
        
        function deleteFile() {
            if (FileSystem.selectedFile) {
                FileSystem.deleteFile(FileSystem.selectedFile.name);
            }
            hideContextMenu();
        }
        
        function getFileInfo() {
            if (FileSystem.selectedFile) {
                const file = FileSystem.selectedFile;
                alert(`Tiedoston tiedot:\n\nNimi: ${file.name}\nTyyppi: ${file.type}\nKoko: ${file.size}`);
            }
            hideContextMenu();
        }
        
        function hideContextMenu() {
            document.getElementById('context-menu').style.display = 'none';
        }
        
        // K√§ytt√§j√§hallinnan funktiot
        function toggleCreateUser() {
            // Avaa k√§ytt√§j√§nluomisikkuna
            const createUserWindow = document.getElementById('create-user-window');
            if (createUserWindow) {
                createUserWindow.style.display = 'flex';
                makeDraggable(createUserWindow, 'create-user');
                document.getElementById('new-username').focus();
            } else {
                // Fallback kirjautumisn√§kym√§√§n
                const form = document.getElementById('create-user-form');
                const isVisible = form.style.display === 'block';
                form.style.display = isVisible ? 'none' : 'block';
                
                if (!isVisible) {
                    document.getElementById('new-username').focus();
                }
            }
            
            PigOSAudio.playClickSound();
        }
        
        function createNewUser() {
            const username = document.getElementById('new-username').value;
            const avatar = document.getElementById('new-avatar').value;
            const usertype = document.getElementById('new-usertype').value;
            
            if (UserManager.createUser(username, avatar, usertype)) {
                // Tyhjenn√§ lomake
                document.getElementById('new-username').value = '';
                document.getElementById('new-avatar').value = 'üë§';
                document.getElementById('new-usertype').value = 'user';
                
                // Sulje ikkuna
                closeApp('create-user');
                
                alert(`K√§ytt√§j√§ "${username}" luotu onnistuneesti!\nVoit nyt kirjautua sis√§√§n uudella k√§ytt√§j√§ll√§.`);
            }
        }
        
        function updateStorageInfo() {
            const storageInfo = StorageManager.getStorageInfo();
            const infoElement = document.getElementById('storage-info');
            
            infoElement.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>Tallennustila:</strong> ${storageInfo.usedFormatted} / ${storageInfo.totalFormatted} (${storageInfo.percentage}%)
                </div>
                <div style="background: #e9ecef; border-radius: 10px; height: 20px; overflow: hidden;">
                    <div style="background: ${storageInfo.percentage > 80 ? '#dc3545' : storageInfo.percentage > 60 ? '#ffc107' : '#28a745'}; 
                                height: 100%; width: ${storageInfo.percentage}%; transition: all 0.3s;"></div>
                </div>
                <div style="margin-top: 5px; font-size: 12px; color: #666;">
                    Vapaana: ${storageInfo.freeFormatted}
                </div>
            `;
            
            PigOSAudio.playClickSound();
        }
        
        function clearUserData() {
            if (confirm('Haluatko varmasti tyhjent√§√§ kaikki tallennetut tiedot?\n\nT√§m√§ poistaa:\n- Kaikki k√§ytt√§j√§t (paitsi j√§rjestelm√§nvalvoja)\n- Kaikki tiedostot\n- Kaikki asetukset')) {
                // S√§ilyt√§ vain j√§rjestelm√§nvalvoja
                const adminUser = UserManager.users.find(u => u.id === 'admin');
                UserManager.users = adminUser ? [adminUser] : [];
                
                // Tyhjenn√§ tallennustila
                PigOSStorage.clear();
                
                // Uudelleenalusta j√§rjestelm√§
                if (adminUser) {
                    UserManager.createUserFileSystem('admin');
                    UserManager.saveUsers();
                }
                
                updateStorageInfo();
                PigOSAudio.playSuccessSound();
                alert('Tiedot tyhjennetty onnistuneesti!');
            }
        }
        
        function shutdownFromLogin() {
            PigOSAudio.playClickSound();
            setTimeout(() => {
                document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: black; color: white; font-size: 24px;">J√§rjestelm√§ on sammutettu</div>';
            }, 1000);
        }
        
        function rebootFromLogin() {
            PigOSAudio.playClickSound();
            
            // N√§yt√§ sammutusruutu
            document.getElementById('shutdown-screen').style.display = 'flex';
            document.getElementById('shutdown-message').textContent = 'K√§ynnistet√§√§n uudelleen...';
            
            // Uudelleenk√§ynnistys√§√§ni
            setTimeout(() => {
                PigOSAudio.playTone(300, 0.2, 0.15);
                setTimeout(() => PigOSAudio.playTone(400, 0.2, 0.15), 200);
                setTimeout(() => PigOSAudio.playTone(500, 0.3, 0.15), 400);
            }, 300);
            
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }
        
        // P√§ivitetty kirjautumisen j√§lkeen ty√∂p√∂yd√§n n√§ytt√§minen
        function showDesktopAfterLogin() {
            document.getElementById('desktop').style.display = 'block';
            document.getElementById('taskbar').style.display = 'flex';
        }
        
        // Lis√§√§ kirjautumisen j√§lkeinen toiminnallisuus
        const originalLoginUser = UserManager.loginUser;
        UserManager.loginUser = function(user) {
            originalLoginUser.call(this, user);
            showDesktopAfterLogin();
        };
        // Piilota kontekstivalikko klikkaamalla muualle
        document.addEventListener('click', () => {
            hideContextMenu();
        });
        function makeDraggable(windowElement) {
            const header = windowElement.querySelector('.window-header');
            let isDragging = false;
            let currentX = 0;
            let currentY = 0;
            let initialX = 0;
            let initialY = 0;

            // Resetoi ikkunan sijainti keskelle ensin
            windowElement.style.left = '50%';
            windowElement.style.top = '50%';
            windowElement.style.transform = 'translate(-50%, -50%)';

            function dragStart(e) {
                if (e.target === header || header.contains(e.target)) {
                    isDragging = true;
                    windowElement.style.zIndex = 1000;
                    
                    // Hanki nykyinen sijainti
                    const rect = windowElement.getBoundingClientRect();
                    currentX = rect.left;
                    currentY = rect.top;
                    
                    if (e.type === "touchstart") {
                        initialX = e.touches[0].clientX - currentX;
                        initialY = e.touches[0].clientY - currentY;
                    } else {
                        initialX = e.clientX - currentX;
                        initialY = e.clientY - currentY;
                    }
                    
                    // Vaihda absoluuttiseen sijaintiin
                    windowElement.style.left = currentX + 'px';
                    windowElement.style.top = currentY + 'px';
                    windowElement.style.transform = 'none';
                }
            }

            function dragEnd(e) {
                isDragging = false;
                windowElement.style.zIndex = 100;
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }

                    // Rajoita ikkunan liikkuminen n√§yt√∂n sis√§lle
                    const maxX = window.innerWidth - windowElement.offsetWidth;
                    const maxY = window.innerHeight - windowElement.offsetHeight;
                    
                    currentX = Math.max(0, Math.min(currentX, maxX));
                    currentY = Math.max(0, Math.min(currentY, maxY));

                    windowElement.style.left = currentX + 'px';
                    windowElement.style.top = currentY + 'px';
                }
            }

            // Poista vanhat listenerit jos on
            header.removeEventListener("mousedown", dragStart);
            header.removeEventListener("touchstart", dragStart);
            
            // Lis√§√§ uudet event listenerit
            header.addEventListener("mousedown", dragStart);
            header.addEventListener("touchstart", dragStart);
            document.addEventListener("mouseup", dragEnd);
            document.addEventListener("touchend", dragEnd);
            document.addEventListener("mousemove", drag);
            document.addEventListener("touchmove", drag);
        }

        // K√§ynnist√§-valikko
        function toggleStartMenu() {
            const startMenu = document.getElementById('start-menu');
            const isVisible = startMenu.style.display === 'flex';
            startMenu.style.display = isVisible ? 'none' : 'flex';
            
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
        }

        // Sammutus- ja uudelleenk√§ynnistystoiminnot
        function shutdownSystem() {
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
            
            // Tallenna nykyisen k√§ytt√§j√§n tiedot ennen sammutusta
            if (UserManager.currentUser) {
                PigOSStorage.save('lastUser', UserManager.currentUser.id);
            }
            
            document.getElementById('shutdown-screen').style.display = 'flex';
            document.getElementById('shutdown-message').textContent = 'Sammutetaan...';
            
            // Sammutus√§√§ni
            setTimeout(() => {
                PigOSAudio.playTone(400, 0.2, 0.15);
                setTimeout(() => PigOSAudio.playTone(300, 0.3, 0.15), 200);
                setTimeout(() => PigOSAudio.playTone(200, 0.5, 0.15), 400);
            }, 500);
            
            setTimeout(function() {
                document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: black; color: white; font-size: 24px;">J√§rjestelm√§ on sammutettu</div>';
            }, 2000);
        }

        function rebootSystem() {
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
            
            // Tallenna nykyisen k√§ytt√§j√§n tiedot ennen uudelleenk√§ynnistyst√§
            if (UserManager.currentUser) {
                PigOSStorage.save('lastUser', UserManager.currentUser.id);
            }
            
            document.getElementById('shutdown-screen').style.display = 'flex';
            document.getElementById('shutdown-message').textContent = 'K√§ynnistet√§√§n uudelleen...';
            
            // Uudelleenk√§ynnistys√§√§ni
            setTimeout(() => {
                PigOSAudio.playTone(300, 0.2, 0.15);
                setTimeout(() => PigOSAudio.playTone(400, 0.2, 0.15), 200);
                setTimeout(() => PigOSAudio.playTone(500, 0.3, 0.15), 400);
            }, 500);
            
            setTimeout(function() {
                window.location.reload();
            }, 2000);
        }

        // Teemanvaihto
        function changeTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            // Tallenna teemavalinta
            PigOSStorage.save('theme', themeName);
            console.log('Teema vaihdettu ja tallennettu:', themeName);
        }

        // P√§ivitysten tarkistus
        async function checkForUpdates() {
            const updateInfo = document.getElementById('update-info');
            updateInfo.innerHTML = '<div class="loading"></div> Tarkistetaan p√§ivityksi√§ GitHubista...';
            
            // Soita klikkaus√§√§ni
            PigOSAudio.playClickSound();
            
            try {
                // T√§ss√§ pit√§√§ vaihtaa oikea GitHub-repositorio!
                const GITHUB_USER = 'sikasaatana';
                const GITHUB_REPO = 'PigOS-Project';
                
                // Hae GitHub API:sta viimeisin commit
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/commits?per_page=1`);
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const commits = await response.json();
                
                if (commits.length === 0) {
                    throw new Error('Ei committeja l√∂ytynyt');
                }
                
                const latestCommit = commits[0];
                const commitDate = new Date(latestCommit.commit.author.date);
                const commitMessage = latestCommit.commit.message;
                const shortSha = latestCommit.sha.substring(0, 7);
                
                // Tarkista onko uudempi versio saatavilla
                const currentVersion = 'v2.0.0';
                const isNewer = checkIfNewerVersion(commitMessage, currentVersion);
                
                if (isNewer) {
                    updateInfo.innerHTML = `
                        <div style="color: #28a745;">
                            <p><strong>üÜï Uusi versio saatavilla!</strong></p>
                            <p><strong>Viimeisin commit:</strong> ${shortSha}</p>
                            <p><strong>P√§iv√§ys:</strong> ${commitDate.toLocaleString('fi-FI')}</p>
                            <p><strong>Muutokset:</strong> ${commitMessage}</p>
                            <button onclick="updateSystem()" style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 10px 0;">
                                ‚¨áÔ∏è P√§ivit√§ nyt
                            </button>
                        </div>
                    `;
                } else {
                    updateInfo.innerHTML = `
                        <div style="color: #28a745;">
                            <p><strong>‚úÖ J√§rjestelm√§ on ajan tasalla!</strong></p>
                            <p><strong>Nykyinen versio:</strong> ${currentVersion}</p>
                            <p><strong>Viimeisin commit:</strong> ${shortSha}</p>
                            <p><strong>Tarkistettu:</strong> ${new Date().toLocaleString('fi-FI')}</p>
                        </div>
                    `;
                }
                
                document.getElementById('latest-version').textContent = isNewer ? 'Uusi saatavilla' : currentVersion;
                
                // Soita onnistumis√§√§ni
                PigOSAudio.playSuccessSound();
                
            } catch (error) {
                console.error('P√§ivitystarkistusvirhe:', error);
                
                updateInfo.innerHTML = `
                    <div style="color: #dc3545;">
                        <p><strong>‚ùå Virhe p√§ivitysten tarkistuksessa</strong></p>
                        <p>${error.message}</p>
                        <p><em>Tarkista GitHub-repositorion tiedot koodista</em></p>
                        
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; color: #007bff;">üîß Kehitt√§j√§tiedot</summary>
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 5px; font-size: 12px;">
                                <p>Voit korjata t√§m√§n muuttamalla koodista:</p>
                                <code>
                                    const GITHUB_USER = 'sinun-kayttaja';<br>
                                    const GITHUB_REPO = 'sinun-repositorio';
                                </code>
                            </div>
                        </details>
                    </div>
                `;
                
                // Soita virhe√§√§ni
                PigOSAudio.playErrorSound();
            }
        }
        
        // Tarkista onko uudempi versio (yksinkertainen tarkistus)
        function checkIfNewerVersion(commitMessage, currentVersion) {
            // Etsi version numero commit-viestist√§
            const versionMatch = commitMessage.match(/v(\d+)\.(\d+)\.(\d+)/);
            if (!versionMatch) return true; // Jos ei l√∂ydy versiota, oleta ett√§ uudempi
            
            const [, major, minor, patch] = versionMatch.map(Number);
            const [currentMajor, currentMinor, currentPatch] = currentVersion.replace('v', '').split('.').map(Number);
            
            return major > currentMajor || 
                   (major === currentMajor && minor > currentMinor) ||
                   (major === currentMajor && minor === currentMinor && patch > currentPatch);
        }
        
        // P√§ivit√§ j√§rjestelm√§ edistyneell√§ latauspalkkilla
        async function updateSystem() {
            if (confirm('Haluatko p√§ivitt√§√§ PigOS:n uusimpaan versioon?\n\nT√§m√§ lataa uusimman version GitHubista ja k√§ynnist√§√§ j√§rjestelm√§n uudelleen.')) {
                const updateInfo = document.getElementById('update-info');
                
                // Luo p√§ivitys-UI
                updateInfo.innerHTML = `
                    <div class="update-progress-container">
                        <h4 style="margin-top: 0; color: #007bff;">üîÑ P√§ivitet√§√§n PigOS...</h4>
                        
                        <div class="update-progress-bar-container">
                            <div class="update-progress-bar" id="update-progress-bar">0%</div>
                        </div>
                        
                        <div class="update-steps">
                            <div class="update-step" id="step-1">Tallennetaan k√§ytt√§j√§tiedot</div>
                            <div class="update-step" id="step-2">Ladataan uusi versio GitHubista</div>
                            <div class="update-step" id="step-3">Asennetaan p√§ivitys</div>
                            <div class="update-step" id="step-4">K√§ynnistet√§√§n j√§rjestelm√§ uudelleen</div>
                        </div>
                        
                        <div id="update-status" style="margin-top: 10px; font-weight: bold; color: #007bff;">
                            Aloitetaan p√§ivitys...
                        </div>
                    </div>
                `;
                
                try {
                    // Vaihe 1: Tallenna k√§ytt√§j√§tiedot (0-25%)
                    await updateProgress(1, 'Tallennetaan k√§ytt√§j√§tiedot...', 15);
                    const currentUser = UserManager.currentUser;
                    if (currentUser) {
                        PigOSStorage.save('updateUser', currentUser.id);
                        PigOSStorage.save('updateTimestamp', new Date().toISOString());
                    }
                    await updateProgress(1, 'K√§ytt√§j√§tiedot tallennettu', 25);
                    
                    // Vaihe 2: Lataa uusi versio (25-60%)
                    await updateProgress(2, 'Yhdistet√§√§n GitHubiin...', 30);
                    PigOSAudio.playTone(400, 0.1, 0.1);
                    
                    const GITHUB_USER = 'sikasaatana';  
                    const GITHUB_REPO = 'PigOS-Project';
                    
                    // Simuloi lataus (oikeassa versiossa latattaisiin GitHub Raw-sis√§lt√∂)
                    await updateProgress(2, 'Ladataan uutta versiota...', 40);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    await updateProgress(2, 'Tarkistetaan tiedostojen eheys...', 50);
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    await updateProgress(2, 'Lataus valmis', 60);
                    PigOSAudio.playTone(500, 0.1, 0.1);
                    
                    // Vaihe 3: Asenna p√§ivitys (60-85%)
                    await updateProgress(3, 'Asennetaan uusia ominaisuuksia...', 65);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    await updateProgress(3, 'P√§ivitet√§√§n tiedostoj√§rjestelm√§...', 75);
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    await updateProgress(3, 'Asennus valmis', 85);
                    PigOSAudio.playTone(600, 0.1, 0.1);
                    
                    // Vaihe 4: Uudelleenk√§ynnistys (85-100%)
                    await updateProgress(4, 'Valmistellaan uudelleenk√§ynnistyst√§...', 90);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    await updateProgress(4, 'K√§ynnistet√§√§n uudelleen...', 95);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    await updateProgress(4, 'P√§ivitys valmis!', 100);
                    
                    // Soita onnistumismelodia
                    PigOSAudio.playSuccessSound();
                    
                    // N√§yt√§ onnistumisviesti
                    document.getElementById('update-status').innerHTML = `
                        <div style="color: #28a745;">
                            ‚úÖ <strong>P√§ivitys onnistui!</strong><br>
                            PigOS k√§ynnistyy uudelleen 3 sekunnin kuluttua...
                        </div>
                    `;
                    
                    // Countdown
                    let countdown = 3;
                    const countdownInterval = setInterval(() => {
                        countdown--;
                        if (countdown > 0) {
                            document.getElementById('update-status').innerHTML = `
                                <div style="color: #28a745;">
                                    ‚úÖ <strong>P√§ivitys onnistui!</strong><br>
                                    PigOS k√§ynnistyy uudelleen ${countdown} sekunnin kuluttua...
                                </div>
                            `;
                        } else {
                            clearInterval(countdownInterval);
                            // K√§ynnist√§ uudelleen cache-ohituksella
                            window.location.reload(true);
                        }
                    }, 1000);
                    
                } catch (error) {
                    updateInfo.innerHTML = `
                        <div style="color: #dc3545; padding: 15px; background: #f8d7da; border-radius: 8px;">
                            <h4>‚ùå P√§ivitys ep√§onnistui</h4>
                            <p><strong>Virhe:</strong> ${error.message}</p>
                            <p>Kokeile my√∂hemmin uudelleen tai p√§ivit√§ sivu manuaalisesti.</p>
                            <button onclick="window.location.reload()" style="background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ P√§ivit√§ sivu
                            </button>
                        </div>
                    `;
                    PigOSAudio.playErrorSound();
                }
            }
        }
        
        // Apufunktio p√§ivityksen etenemiselle
        async function updateProgress(step, message, percentage) {
            // P√§ivit√§ palkki
            const progressBar = document.getElementById('update-progress-bar');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = percentage + '%';
            }
            
            // P√§ivit√§ status
            const statusElement = document.getElementById('update-status');
            if (statusElement) {
                statusElement.textContent = message;
            }
            
            // P√§ivit√§ askelten tila
            for (let i = 1; i <= 4; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (stepElement) {
                    if (i < step) {
                        stepElement.className = 'update-step completed';
                    } else if (i === step) {
                        stepElement.className = 'update-step active';
                    } else {
                        stepElement.className = 'update-step';
                    }
                }
            }
            
            // Odota hetki animaatiota varten
            await new Promise(resolve => setTimeout(resolve, 200));
        }

        // √Ñ√§nen hallinta
        let isMuted = false;
        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('volume-control').textContent = isMuted ? 'üîá' : 'üîä';
            // Tallenna √§√§niasetukset
            PigOSStorage.save('muted', isMuted);
            console.log('√Ñ√§niasetukset tallennettu:', isMuted);
        }

        // Matopeli
        let snakeGameActive = false;
        let snake, food, direction, gameLoop, score;

        function initSnakeGame() {
            const canvas = document.getElementById('snake-canvas');
            const ctx = canvas.getContext('2d');
            
            // Alusta peli
            snake = [{x: 10, y: 10}];
            food = generateFood();
            direction = 'right';
            score = 0;
            snakeGameActive = true;
            
            document.getElementById('snake-score').textContent = 'Pisteet: 0';
            document.getElementById('game-over-message').style.display = 'none';
            
            // Piirr√§ peli
            drawSnakeGame(ctx);
            
            // Aloita pelisilmukka
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(() => gameUpdate(ctx), 150);
            
            // Lis√§√§ n√§pp√§imist√∂n kuuntelija
            window.addEventListener('keydown', handleKeyPress);
        }

        function gameUpdate(ctx) {
            if (!snakeGameActive) return;
            
            // Liikuta k√§rmett√§
            const head = {...snake[0]};
            
            switch(direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }
            
            // Tarkista t√∂rm√§ykset
            if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || 
                snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }
            
            // Lis√§√§ uusi p√§√§
            snake.unshift(head);
            
            // Tarkista onko ruokaa sy√∂ty
            if (head.x === food.x && head.y === food.y) {
                score++;
                document.getElementById('snake-score').textContent = `Pisteet: ${score}`;
                food = generateFood();
                
                // Soita onnistumis√§√§ni kun sy√∂d√§√§n ruokaa
                PigOSAudio.playTone(400 + score * 50, 0.1, 0.1);
            } else {
                // Poista h√§nt√§ jos ruokaa ei sy√∂ty
                snake.pop();
            }
            
            // Piirr√§ peli
            drawSnakeGame(ctx);
        }

        function drawSnakeGame(ctx) {
            const canvas = document.getElementById('snake-canvas');
            const cellSize = canvas.width / 20;
            
            // Tyhjenn√§ kentt√§
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Piirr√§ ruoka
            ctx.fillStyle = '#FF5252';
            ctx.fillRect(food.x * cellSize, food.y * cellSize, cellSize, cellSize);
            
            // Piirr√§ k√§rme
            ctx.fillStyle = '#4CAF50';
            snake.forEach(segment => {
                ctx.fillRect(segment.x * cellSize, segment.y * cellSize, cellSize, cellSize);
            });
        }

        function generateFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * 20),
                    y: Math.floor(Math.random() * 20)
                };
            } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
            
            return newFood;
        }

        function handleKeyPress(e) {
            if (!snakeGameActive) return;
            
            switch(e.key) {
                case 'ArrowUp':
                    if (direction !== 'down') direction = 'up';
                    break;
                case 'ArrowDown':
                    if (direction !== 'up') direction = 'down';
                    break;
                case 'ArrowLeft':
                    if (direction !== 'right') direction = 'left';
                    break;
                case 'ArrowRight':
                    if (direction !== 'left') direction = 'right';
                    break;
            }
        }

        function gameOver() {
            snakeGameActive = false;
            clearInterval(gameLoop);
            
            const gameOverMessage = document.getElementById('game-over-message');
            document.getElementById('final-score').textContent = `Lopetuspisteet: ${score}`;
            gameOverMessage.style.display = 'block';
            
            // Soita game over -√§√§ni
            PigOSAudio.playErrorSound();
            
            window.removeEventListener('keydown', handleKeyPress);
        }

        function restartSnakeGame() {
            initSnakeGame();
        }

        // Est√§ start-valikon sulkeutuminen kun sit√§ klikataan
        document.addEventListener('DOMContentLoaded', function() {
            // Est√§ start-valikon sulkeutuminen kun sit√§ klikataan
            const startMenu = document.getElementById('start-menu');
            if (startMenu) {
                startMenu.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });

        // Sulje start-valikko kun klikataan muualle
        document.addEventListener('click', function(e) {
            const startMenu = document.getElementById('start-menu');
            const startButton = document.querySelector('.start-button');
            
            // √Ñl√§ sulje jos klikataan start-nappia
            if (e.target === startButton || startButton.contains(e.target)) {
                return;
            }
            
            if (startMenu && startMenu.style.display === 'flex') {
                startMenu.style.display = 'none';
            }
            
            hideContextMenu();
        });
    </script>
</body>
</html>
